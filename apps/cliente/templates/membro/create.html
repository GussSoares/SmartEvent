{% extends "index.html" %}
{% load static %}

{% block title_page %}
  Membros
{% endblock %}

{% block title_side_buttons %}
  <button class="btn btn-primary" onclick="$('.modal-content').load('{% url "member:create_member" %}')" data-target="#ajax" data-toggle="modal">
    <i class="fas fa-plus-circle"></i> Cadastrar
  </button>
{% endblock %}

{% block content %}
  <div class="row">
{#    <div class="col-md-6">#}
{#      {% include "membro/includes/form.html" %}#}
{#    </div>#}
    <div class="col-md-12">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-list"></i>&nbsp;&nbsp;
            Membros Ativos
          </h2>
          <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse">
              <i class="fas fa-minus"></i>
            </button>
            <button type="button" class="btn btn-tool" data-card-widget="maximize"><i class="fas fa-expand"></i></button>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-12">
              <table id="example2" class="table dataTable table-bordered table-hover">
                <thead>
                <tr>
                  <th class="all">Nome</th>
                  <th class="all">Grupo</th>
                  <th>Email</th>
                  <th>CPF/CNPJ</th>
                  <th>Data de Nascimento</th>
                  <th>Endereço</th>
                  <th class="all">Telefone</th>
                  <th class="all">Ações</th>
                </tr>
                </thead>
                <tbody>
                {% for member in members %}
                  <tr>
                    <td>{{ member.cliente.full_name }}</td>
                    <td>{{ member.grupo.descricao|default_if_none:'--' }}</td>
                    <td>{{ member.cliente.email|default_if_none:'--' }}</td>
                    <td>{{ member.cliente.cpf_cnpj|default_if_none:'--' }}</td>
                    <td>{{ member.cliente.data_nascimento|date:'d/m/Y' }}</td>
                    <td>{{ member.cliente.full_address|default_if_none:'--' }}</td>
                    <td>{{ member.cliente.telefone|default_if_none:'--' }}</td>
                    <td>
                      <div class="btn-group-sm btn-group">
                        <a title="Editar" class="btn btn-default" onclick="$('.modal-content').load('{% url "member:update_member" pk=member.id %}')" data-target="#ajax" data-toggle="modal"><i class="fas fa-pen"></i></a>
{#<!--                        <a title="Alterar Senha" class="btn btn-default" onclick="$('.modal-content').load('{% url "client:set_password" pk=member.cliente.id %}')" data-target="#ajax" data-toggle="modal"><i class="fas fa-lock"></i></a>-->#}
                        <button onclick="deletar_member({{ member.cliente.id }})" title="Remover" class="btn btn-danger"><i class="fas fa-trash"></i></button>
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="ajax" role="basic" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-body">
          <i class="fas fa-sync fa-spin loading-img"></i>
          <span> &nbsp;&nbsp;Carregando…</span>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block css %}
  <link rel="stylesheet" href="{% static 'plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}"/>
  <link rel="stylesheet" href="{% static 'plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}" />
  <link rel="stylesheet" href="{% static 'plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}" />
  <link rel="stylesheet" href="{% static 'plugins/select2/css/select2.min.css' %}" />

{% endblock %}
{% block js %}

  <script src="{% static "dist/js/ui-modals/ui-modals.min.js" %}"></script>
  <script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
  <script src="{% static 'plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
  <script src="{% static 'plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
  <script src="{% static 'plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
  <script src="{% static 'plugins/bootbox/bootbox.all.min.js' %}"></script>
  <script src="{% static 'plugins/bootbox/bootbox.locales.min.js' %}"></script>
  <script src="{% static 'plugins/select2/js/select2.full.min.js' %}"></script>
  <script>
    $('#example2').DataTable({
      "autoWidth": false,
      "responsive": true,
    });

    $('#ajax').on('shown.bs.modal', function () {
      $('.date').datepicker({
        daysOfWeekHighlighted: '06',
        format: 'dd/mm/yyyy',
        todayHighlight: true,
        autoclose: true
      });
      $('.select2').select2({
        allowClear: true,
        placeholder: 'Selecione um grupo',
        theme: 'bootstrap4'
      })
    })

    $('.select2').select2({
      allowClear: true,
      placeholder: 'Selecione um grupo',
      theme: 'bootstrap4'
    })

    function deletar_member(id) {
      bootbox.confirm({
        title: "Ateção",
        message: "Deseja realmente remover este registro?",
        buttons: {
          cancel: {
            label: '<i class="fa fa-times"></i> Cancel'
          },
          confirm: {
            label: '<i class="fa fa-check"></i> Confirm',
            className: 'btn-danger'
          }
        },
        callback: function (result) {
          if (result == true) {
            $.ajax({
              url: `/member/delete-member/${id}`,
              complete: function (data) {
                window.location.reload();
              }
            })
          }
        }
      })
    }
  </script>
{% endblock %}
